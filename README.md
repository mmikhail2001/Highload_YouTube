# Highload YouTube

## Содержание
* ### [1. Тема, целевая аудитория и расчет нагрузки](#1)
* ### [2. Логическая схема](#2)

## 1. Тема, аудитория и нагрузка <a name="1"></a>

### 1.1 Тема
Сервис **YouTube** - видеохостинг, предоставляющий пользователям услуги хранения, доставки и показа видео

### 1.2 MVP
Функциональность сервиса
1. **Просмотр** видео
2. **Загрузка** видео
3. **Комментирование, лайки, подписки** на канал
4. **Рекомендации** на главной странице и похожих видео на странице видео

> P.S. Авторизации происходят на стороне Google Аккаунт.

### 1.3 Целевая аудитория
- Местоположение - **Россия**
- **Размер аудитории** на локальном рынке \[[1](https://mediascope.net/data/#internet)]
	- месячный охват 95 млн. человек
	- дневной охват 52 млн. человек

### 1.4 Расчет нагрузки

Статистика для расчетов

|Метрика|Аудитория|Значение|
| ------------- | --- |-------------|
|MAU (чел.)|Мир|2500 млн.|
|MAU (чел.)|Россия|95 млн.|
|DAU (чел.)|Россия|52 млн.|
|Количество просмотров / месяц|Мир|207 млрд.|
|Загрузка видео / день (час) |Мир|271 тыс.|
|Количество комментариев / 1000 просмотров |Мир|5|
|Количество лайков / 100 просмотров|Мир|4|
|Количество новых подписок / день / канал|Мир|1000|
|Средняя продолжительность видео (мин) |Мир|11.7|
|Количество посещений страниц / день / пользователь |Мир|9|

#### 1.4.1 Продуктовые метрики

|Тип запроса|Количество запросов / месяц|
| ------------- |-------------|
|Выдача рекомендаций|276 млрд.|
|Просмотр видео|207 млрд.|
|Добавление лайка|8.28 млрд.|
|Подписка|3.6 млрд.|
|Добавление комментария|1 млрд.|
|Загрузка видео на канал|1.6 млн.|

***Расчет количества запросов по каждому типу***
- Среднее количество действий пользователей
	- Просмотр видео - 207 млрд. / мес.
		- Ежемесячно российская аудитория производит 207 млрд \[[4](https://www.globalmediainsight.com/blog/youtube-users-statistics/#:~:text=YouTube%20Views%20by%20Country)]. просмотров.
	- Комментарии - 1 млрд. / мес.
		- На каждые 1000 просмотров приходится 5 комментариев \[[5](https://tubularlabs.com/blog/3-metrics-youtube-success/#:~:text=Comments%20to%20Views%3A%20How%20High%20is%20Engagement%3F)].
		- Значит, в месяц происходит ```207 млрд. / 1000 * 5 = 1 млрд``` запросов на добавление комментария.
	- Лайки - 8.28 млрд. / мес.
		- На каждые 100 просмотров приходится 4 комментариев \[[6](https://tubularlabs.com/blog/3-metrics-youtube-success/#:~:text=Likes%20to%20Views%3A%20How%20Popular%20is%20Your%20Video%3F)].
		- Значит, в месяц происходит ```207 млрд. / 100 * 4 = 8.28 млрд``` запросов на установку лайка.
	- Подписки - 3.6 млрд. / мес.
		- В среднем, каждый канал в день набирает 1 тыс. подписчиков \[[7](https://medium.com/@jasonrbodie/average-youtube-channel-growth-rate-f6837584c9ac)] при 2.5 млрд. активных пользователей в месяц.
		- Приблизительно каждый канал на локальном рынке в день набирает ```1_000 * (95 / 2500) = 38```.
		- Месячный охват аудитории в России - 95 млн. человек.
		- Значит, ```95 млн. * 38 = 3.6 млрд ``` подписок осуществляется в месяц. 
	- Загрузка видео - 1.6 млн. / мес.
		- В России загружается 10.3. тыс. часов контента в день (см. вычисления выше).
		- Каждое видео в среднем длится 11.7 минут \[[8](https://bloggingwizard.com/youtube-statistics/#:~:text=7.-,The%20average%20length%20of%20a%20YouTube%20video%20is%2011.7%20minutes,-According%20to%20Statista)].
		- Следовательно, 1.6 млн. видеороликов в месяц загружаются на платформу.  
		- ```(10_300 * 60) минут * 30 / 11.7 = 1.6 млн. видео```
	- Рекомендации -  276 млрд. / мес.
		- В среднем, каждый пользователь в день посещает 9 страниц сервиса \[[9](https://www.globalmediainsight.com/blog/youtube-users-statistics/#:~:text=An%20average%20YouTube%20visitor%20checks%20nearly%20nine%20pages%20per%20day.%C2%A0)].
		- Допустим, на каждые 3 посещения страницы видео приходится одно посещение главной страницы
		- Тогда, общее количество посещений этих страниц, а, следовательно, и предложенных рекомендаций 276 млрд. 
		- ```207 млрд. + 207 млрд. * 1/3 = 276 млрд.```
#### 1.4.2 Технические метрики
- Размер хранения на каждого пользователя - 1500 мб на видео в год и 3 Мб на данные пользователя
	- Во всем мире 271 тыс. часов видео загружается на платформу каждый день \[[2](https://www.wyzowl.com/youtube-stats/#:~:text=4.4%20minutes.-,How%20many%20videos%20are%20uploaded%20to%20YouTube%20every%20day%3F,-Around%203.7m%20new)]
	- Пользователей со всего мира 2.5 млрд, в России 95 млн
		- Значит, в России будет загружаться 10.3. тыс. часов контента в день.
		- ```271_000 часов * (95 / 2500) = 10_300 часов```
	- Допустим, все видео имеют разрешения 1080p с частотой кадров 30 fps в формате SDR \[[3](https://support.google.com/youtube/answer/1722171?hl=en#zippy=%2Cframe-rate%2Cbitrate%2Cvideo-codec-h%2Cvideo-resolution-and-aspect-ratio%2Ccolor-space:~:text=Recommended%20video%20bitrates%20for%20SDR%20uploads)]. В хранилище имеются все разрешения для обеспечения адаптивного битрейта.
		- 1080p - 8 Mbps
		- 720p - 5 Mbps                                                 
		- 480p - 2.5 Mbps
		- 360p - 1 Mbps
	- ```(10_300 час * 60 * 60) сек * (8 + 5 + 2.5 + 1) Mpbs / 8 / 1024 = 74 тыс. Гб```
	- В день 95 млн. человек загружают 74 тыс. Гб видео. Значит, в среднем, каждый год на каждого пользователя требуется 500 Мб памяти для хранения видео (не включая резервные копии)
		- ```(74_000 Гб / 52_000_000 чел. ) * 365 = 0.5 Гб = 500 Мб```
	- Для обеспечения надежности хранения данных в S3 хранилище допустим, что каждое видео имеет 2 резервные копии. Таким образом, в год на одного пользователя необходимо резеврировать хранилище размером 1500 Мб. 
	- Допустим, остальная информация пользователя (профиль, аватарка, данные о подписках, превью видео, описания видео, статистика по каналу и видео) занимает 3 Мб.
## 2. Логическая схема <a name="2"></a>

